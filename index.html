<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Lab Location QR</title>

    <script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>

    <style>
      body {
        font-family: Arial, sans-serif;
        text-align: center;
        padding: 30px;
      }

      #qrWrapper svg {
        width: 300px;
        height: 300px;
        border: 2px solid #000;
        margin-top: 20px;
      }

      button {
        margin: 10px;
        padding: 10px 18px;
        font-size: 15px;
        cursor: pointer;
      }
    </style>
  </head>

  <body>
    <h2>Lab Location QR</h2>

    <div id="qrWrapper"></div>

    <button onclick="downloadSVG()">Download SVG</button>
    <button onclick="downloadPNG()">Download PNG</button>
    <button onclick="downloadPDF()">Download PDF</button>

    <script>
      const MAP_LINK = "https://www.google.com/maps?q=30.7586389,76.6747778";

      let finalSVG = "";

      QRCode.toString(
        MAP_LINK,
        {
          type: "svg",
          errorCorrectionLevel: "H",
          margin: 2,
        },
        (err, qrSvg) => {
          if (err) {
            alert("QR generation failed");
            return;
          }

          const parser = new DOMParser();
          const doc = parser.parseFromString(qrSvg, "image/svg+xml");
          const svg = doc.documentElement;

          // Force print size
          svg.setAttribute("width", "400");
          svg.setAttribute("height", "400");

          document.getElementById("qrWrapper").appendChild(svg);
          finalSVG = new XMLSerializer().serializeToString(svg);
        }
      );

      // SVG download
      function downloadSVG() {
        const blob = new Blob([finalSVG], { type: "image/svg+xml" });
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = "Lab-QR.svg";
        a.click();
        URL.revokeObjectURL(url);
      }

      // PNG download
      function downloadPNG() {
        const img = new Image();
        const svgBlob = new Blob([finalSVG], { type: "image/svg+xml" });
        const url = URL.createObjectURL(svgBlob);

        img.onload = () => {
          const canvas = document.createElement("canvas");
          canvas.width = 800;
          canvas.height = 800;
          const ctx = canvas.getContext("2d");

          ctx.fillStyle = "#ffffff";
          ctx.fillRect(0, 0, canvas.width, canvas.height);
          ctx.drawImage(img, 0, 0, 800, 800);

          const a = document.createElement("a");
          a.href = canvas.toDataURL("image/png");
          a.download = "Lab-QR.png";
          a.click();

          URL.revokeObjectURL(url);
        };

        img.src = url;
      }

      // PDF download
      function downloadPDF() {
        const { jsPDF } = window.jspdf;

        const img = new Image();
        const svgBlob = new Blob([finalSVG], {
          type: "image/svg+xml;charset=utf-8",
        });
        const url = URL.createObjectURL(svgBlob);

        img.onload = () => {
          const canvas = document.createElement("canvas");
          canvas.width = 800;
          canvas.height = 800;
          const ctx = canvas.getContext("2d");

          ctx.fillStyle = "#ffffff";
          ctx.fillRect(0, 0, canvas.width, canvas.height);
          ctx.drawImage(img, 0, 0, canvas.width, canvas.height);

          const pngData = canvas.toDataURL("image/png");

          const pdf = new jsPDF({
            orientation: "portrait",
            unit: "mm",
            format: "a4",
          });

          pdf.addImage(pngData, "PNG", 30, 30, 150, 150);
          pdf.save("Lab-QR.pdf");

          URL.revokeObjectURL(url);
        };

        img.onerror = () => {
          alert("PDF generation failed");
          URL.revokeObjectURL(url);
        };

        img.src = url;
      }
    </script>
  </body>
</html>
